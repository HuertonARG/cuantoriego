<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis Interactivo de Consumo de Agua de Plantas Modelo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- PALETA DE COLORES HUERT√ìN --- */
        /* Dark Green (Primary Headers/Borders): #1B5E20 */
        /* Vibrant Green (Accent/KPI Results): #7AD14C */
        /* Subtle Text/Gray: #5C5148 (Kept for readability) */
        /* Light Green Background for results: #F0F7F0 */
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F5F1; 
            color: #3C4D32; /* Darker, slightly greener body text */
        }
        .card {
            background-color: #FFFFFF;
            border: 1px solid #E5E0D8;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .input-group label {
            font-weight: 600;
            color: #1B5E20; /* Dark Green for labels */
        }
        .kpi-value {
            font-size: 2.25rem; 
            font-weight: 700;
            color: #7AD14C; /* Vibrant Green for results */
        }
        .kpi-subtitle {
            font-size: 1rem;
            color: #5C5148; /* Neutral gray for subtitle */
        }
        .interpretation-table th, .interpretation-table td {
            padding: 0.5rem 0.75rem;
            text-align: left;
        }
        .interpretation-table th {
            background-color: #E5E0D8;
            font-weight: 600;
            color: #1B5E20; /* Dark Green header text */
        }
        .interpretation-table tr:nth-child(even) {
            background-color: #FAF8F5;
        }
        /* Custom Button Style */
        .brand-btn {
            background-color: #1B5E20; 
            transition: background-color 200ms;
        }
        .brand-btn:hover {
            background-color: #2E7D32; 
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Encabezado con estilo de tarjeta (card) e imagen del logo -->
        <header class="text-center mb-10 card p-6">
            <!-- Logo de la Marca HUERT√ìN. Se mantiene la referencia correcta. -->
            <div class="flex flex-col items-center justify-center mb-4">
                <img src="uploaded:Logo tienda nube.png-f08eab53-094b-49cf-a722-05aedf5a8665" alt="Logo de Huert√≥n" class="h-20 w-auto mb-4">
            </div>
            <!-- T√≠tulo Principal - Usa el Dark Green de la marca -->
            <h1 class="text-3xl sm:text-4xl font-bold text-[#1B5E20]">¬øCu√°nto Riego?</h1>
            <p class="mt-2 text-lg text-[#5C5148] max-w-4xl mx-auto">Esta es una herramienta que te permite saber cu√°nto y cuando ten√©s que regar tu planta. Los resultados est√°n estandarizados a situaciones clim√°ticas modelo, y la realidad suele tener otras complejidades, por eso te recomiendo que lo tomes como una **aproximaci√≥n**.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Columna 1: Definici√≥n del Escenario Clave -->
            <div class="lg:col-span-1 card p-6 space-y-6">
                <!-- T√≠tulo de Secci√≥n 1 - Usa el Dark Green de la marca -->
                <h2 class="text-xl font-semibold text-[#1B5E20] border-b pb-3 mb-4">1. ¬øC√≥mo est√° el clima hoy?</h2>
                <!-- Descripci√≥n de Secci√≥n 1 -->
                <p class="text-sm text-[#5C5148]">Ingres√° las variables clim√°ticas actuales. Pod√©s obtenerlas facilmente en tu app del clima que normalmente usas.</p>
                
                <div class="space-y-4">
                    
                    <!-- Selector de Ubicaci√≥n -->
                    <div class="input-group">
                        <label for="location" class="block mb-1">Ubicaci√≥n de la Maceta:</label>
                        <select id="location" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-[#7AD14C] focus:border-[#7AD14C]">
                            <option value="Interior" selected>Dentro de Casa/Oficina</option>
                            <option value="Exterior">Balc√≥n, Terraza, o Exterior</option>
                        </select>
                    </div>

                    <!-- GRUPO DE INPUTS DEPENDIENTES DE EXTERIOR -->
                    <div id="outdoorInputs" class="space-y-4">
                        <!-- Radiaci√≥n Solar -->
                        <div class="input-group">
                            <label for="radiacion" class="block mb-1">Radiaci√≥n Solar:</label>
                            <select id="radiacion" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-[#7AD14C] focus:border-[#7AD14C]">
                                <option value="Soleado">Soleado/Despejado</option>
                                <option value="Parcialmente Nublado">Parcialmente Nublado</option>
                                <option value="Mayormente Nublado">Mayormente Nublado/Gris</option>
                            </select>
                        </div>

                        <!-- Velocidad del Viento -->
                        <div class="input-group">
                            <label for="velViento" class="block mb-1">Velocidad del Viento (km/h):</label>
                            <input type="number" id="velViento" placeholder="Ej: 15" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-[#7AD14C] focus:border-[#7AD14C]">
                            <p id="windLevel" class="text-xs mt-1 text-gray-500"></p>
                        </div>
                    </div>
                    <!-- FIN GRUPO DE INPUTS DEPENDIENTES DE EXTERIOR -->


                    <!-- Temperatura M√°xima (SIEMPRE VISIBLE) -->
                    <div class="input-group">
                        <label for="tempMax" class="block mb-1">Temperatura M√°xima (¬∞C):</label>
                        <input type="number" id="tempMax" placeholder="Ej: 25" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-[#7AD14C] focus:border-[#7AD14C]">
                        <p id="tempLevel" class="text-xs mt-1 text-gray-500"></p>
                    </div>

                    <!-- Humedad Relativa (SIEMPRE VISIBLE) -->
                    <div class="input-group">
                        <label for="humedadRelativa" class="block mb-1">Humedad Relativa (%):</label>
                        <input type="number" id="humedadRelativa" placeholder="Ej: 60" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-[#7AD14C] focus:border-[#7AD14C]">
                        <p id="humidityLevel" class="text-xs mt-1 text-gray-500"></p>
                    </div>

                    <!-- Bot√≥n de marca (Dark Green) -->
                    <button id="calculateScenarioBtn" class="w-full brand-btn text-white font-bold py-2 px-4 rounded-lg">
                        Calcular Escenario Clim√°tico
                    </button>
                    <div id="errorMsg" class="text-red-500 text-center text-sm mt-3 hidden"></div>
                </div>
            </div>

            <!-- Columna 2: Resultados del Escenario y Selecci√≥n de Planta -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Resultado del Escenario Clave -->
                <div class="card p-6">
                    <!-- T√≠tulo de Secci√≥n 2 - Usa el Dark Green de la marca -->
                    <h2 class="text-xl font-semibold text-[#1B5E20] border-b pb-3 mb-4">2. Escenario Clim√°tico Determinado</h2>
                    <!-- Fondo ligeramente verde claro -->
                    <div class="flex flex-col sm:flex-row justify-between items-center bg-[#F0F7F0] p-4 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <span class="text-4xl">üå§Ô∏è</span>
                            <div>
                                <p class="text-sm font-medium text-gray-600">Nivel de Estr√©s Ambiental (RS, Tmax, Vw, HR):</p>
                                <p id="scenarioLevels" class="text-2xl font-bold text-[#1B5E20]">--</p>
                            </div>
                        </div>
                        <div class="mt-4 sm:mt-0 text-right">
                            <!-- Evapotranspiraci√≥n de Referencia (ET0) - Usa el Vibrant Green de la marca -->
                            <p class="text-sm font-medium text-gray-600">Evapotranspiraci√≥n de Referencia:</p>
                            <p id="et0Result" class="text-4xl font-extrabold text-[#7AD14C]">-- mm/d√≠a</p>
                            <p id="et0Warning" class="text-sm text-red-600 mt-1 hidden">‚ùå Error: La clave de escenario no se encontr√≥ en la tabla.</p>
                        </div>
                    </div>
                </div>

                <!-- Selecci√≥n de Planta Modelo -->
                <div class="card p-6">
                    <!-- T√≠tulo de la secci√≥n 3 - Usa el Dark Green de la marca -->
                    <h2 class="text-xl font-semibold text-[#1B5E20] border-b pb-3 mb-4">3. ¬øQu√© tipo de planta vas a regar?</h2>
                    <div class="flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-6">
                        <div class="w-full sm:w-1/2">
                            <!-- Etiqueta de selecci√≥n -->
                            <label for="plantModel" class="block mb-1 font-semibold">Tipo de planta:</label>
                            <select id="plantModel" class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-[#7AD14C] focus:border-[#7AD14C]" disabled>
                                <option value="" disabled selected>Primero Calcule el Escenario</option>
                                <!-- Opciones de plantas -->
                                <option value="PM1">Cactus/Suculenta</option>
                                <option value="PM2">Planta de Interior (Hojas Duras)</option>
                                <option value="PM3">Ornamental de Maceta</option>
                                <option value="PM4">Hortaliza de Hoja/Fruto (Activa)</option>
                                <option value="PM5">C√©sped/Pasto</option>
                            </select>
                        </div>
                        <div class="w-full sm:w-1/2 flex items-center h-full">
                            <!-- √Årea vac√≠a para la informaci√≥n t√©cnica -->
                            <p id="kcValue" class="text-base font-medium text-gray-600 pt-6 sm:pt-0"></p>
                        </div>
                    </div>
                </div>

                <!-- Resultados de Consumo y Tabla de Interpretaci√≥n (Secci√≥n 4) -->
                <div class="card p-6">
                    <!-- T√≠tulo de la secci√≥n 4 - Usa el Dark Green de la marca -->
                    <h2 class="text-xl font-semibold text-[#1B5E20] border-b pb-3 mb-4">4. Resultados de Consumo de Agua</h2>
                    
                    <!-- Resultados KPI -->
                    <!-- Fondo ligeramente verde claro -->
                    <div id="resultsGrid" class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center mb-6">
                        <div class="bg-[#F0F7F0] p-4 rounded-lg">
                            <p class="kpi-value" id="consumoHora">--</p>
                            <p class="kpi-subtitle">Consumo Estimado por Hora (mL/h)</p>
                        </div>
                        <div class="bg-[#F0F7F0] p-4 rounded-lg">
                            <p class="kpi-value" id="caudalDiario">--</p>
                            <p class="kpi-subtitle">Riego Diario (mL/d√≠a)</p>
                        </div>
                        <div class="bg-[#F0F7F0] p-4 rounded-lg">
                            <p class="kpi-value" id="diasReserva">--</p>
                            <p class="kpi-subtitle">D√≠as hasta Agotar Reservas (Freq.)</p>
                        </div>
                    </div>

                    <!-- Tabla de Interpretaci√≥n -->
                    <h3 class="text-lg font-semibold text-[#1B5E20] mt-6 mb-3 border-t pt-4">Gu√≠a para la Interpretaci√≥n de Resultados</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full interpretation-table border-collapse rounded-lg overflow-hidden">
                            <thead>
                                <tr>
                                    <th class="w-1/3">M√©trica</th>
                                    <th class="w-2/3">Significado y Uso</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>**Consumo por Hora** (mL/h)</td>
                                    <td>Estima la velocidad de evaporaci√≥n y transpiraci√≥n de la planta bajo las condiciones clim√°ticas actuales. √ötil para sistemas de riego por goteo o dosificaci√≥n constante.</td>
                                </tr>
                                <tr>
                                    <td>**Riego Diario** (mL/d√≠a)</td>
                                    <td>Es la cantidad de agua que la planta *necesita* reponer en 24 horas para mantenerse saludable. **Esta es la dosis clave de riego.**</td>
                                </tr>
                                <tr>
                                    <td>**D√≠as hasta Agotar Reservas** (Freq.)</td>
                                    <td>Calcula cu√°ntos d√≠as tardar√° tu planta en consumir su reserva de agua. Indica la **frecuencia de riego**.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Enlace a la p√°gina web de Huert√≥n agregado aqu√≠ -->
                    <p class="text-center mt-6 text-base font-semibold text-[#1B5E20] border-t pt-4">
                        Visit√° nuestra web para m√°s consejos de cuidado de plantas: 
                        <a href="https://www.huerton.com" target="_blank" class="text-[#7AD14C] hover:underline font-bold">www.huerton.com</a>
                    </p>
                </div> 

            </div>
        </main>
        
        <footer class="text-center mt-10 text-sm text-[#A69B8F] border-t pt-4">
            <p>Datos basados en el Coeficiente de Cultivo ($K_c$) y la Evapotranspiraci√≥n de Referencia ($ET_0$) del escenario clave.</p>
        </footer>
    </div>

    <script>
        // Rangos de clasificaci√≥n para Tmax (¬∞C), Vw (km/h) y HR (%)
        const LEVEL_RANGES = {
            Tmax: { B: '< 20', M: '20 - 28', A: '> 28' },
            Vw: { B: '< 10', M: '10 - 25', A: '> 25' },
            HR: { B: '< 55', M: '55 - 75', A: '> 75' }
        };

        // Mapeo de los 81 escenarios clave (RS, Tmax, Vw, HR) a ET0 (mm/d√≠a)
        // Nota: Los datos de ET0 se han migrado desde el JSON.
        const ET0_MAP = {
            'A,A,A,B': 8.5, 'A,A,A,M': 8.0, 'A,A,A,A': 7.5,
            'A,A,M,B': 8.0, 'A,A,M,M': 7.5, 'A,A,M,A': 7.0,
            'A,A,B,B': 7.5, 'A,A,B,M': 7.0, 'A,A,B,A': 6.5,
            'A,M,A,B': 7.5, 'A,M,A,M': 7.0, 'A,M,A,A': 6.5,
            'A,M,M,B': 7.0, 'A,M,M,M': 6.5, 'A,M,M,A': 6.0,
            'A,M,B,B': 6.5, 'A,M,B,M': 6.0, 'A,M,B,A': 5.5,
            'A,B,A,B': 6.5, 'A,B,A,M': 6.0, 'A,B,A,A': 5.5,
            'A,B,M,B': 6.0, 'A,B,M,M': 5.5, 'A,B,M,A': 5.0,
            'A,B,B,B': 5.5, 'A,B,B,M': 5.0, 'A,B,B,A': 4.5,
            'M,A,A,B': 7.0, 'M,A,A,M': 6.5, 'M,A,A,A': 6.0,
            'M,A,M,B': 6.5, 'M,A,M,M': 6.0, 'M,A,M,A': 5.5,
            'M,A,B,B': 6.0, 'M,A,B,M': 5.5, 'M,A,B,A': 5.0,
            'M,M,A,B': 5.5, 'M,M,A,M': 5.0, 'M,M,A,A': 4.5,
            'M,M,M,B': 5.0, 'M,M,M,M': 4.5, 'M,M,M,A': 4.0,
            'M,M,B,B': 4.5, 'M,M,B,M': 4.0, 'M,M,B,A': 3.5,
            'M,B,A,B': 4.0, 'M,B,A,M': 3.0, 'M,B,A,A': 2.5,
            'M,B,M,B': 3.5, 'M,B,M,M': 3.0, 'M,B,M,A': 2.5,
            'M,B,B,B': 3.0, 'M,B,B,M': 2.5, 'M,B,B,A': 2.0,
            'B,A,A,B': 6.0, 'B,A,A,M': 5.5, 'B,A,A,A': 5.0,
            'B,A,M,B': 5.5, 'B,A,M,M': 5.0, 'B,A,M,A': 4.5,
            'B,A,B,B': 5.0, 'B,A,B,M': 4.5, 'B,A,B,A': 4.0,
            'B,M,A,B': 3.5, 'B,M,A,M': 3.0, 'B,M,A,A': 2.5,
            'B,M,M,B': 3.0, 'B,M,M,M': 2.5, 'B,M,M,A': 2.0,
            'B,M,B,B': 2.5, 'B,M,B,M': 2.0, 'B,M,B,A': 1.5,
            'B,B,A,B': 2.0, 'B,B,A,M': 1.5, 'B,B,A,A': 1.0, 
            'B,B,M,B': 1.5, 'B,B,M,M': 1.0, 'B,B,M,A': 1.0, 
            'B,B,B,B': 1.5, 'B,B,B,M': 1.0, 'B,B,B,A': 1.0, 
        };

        let currentET0 = null;
        let currentWaterVolume = 500; // Reserva de agua por defecto: 500 mL

        // Mensajes que pueden aparecer en la zona 3
        const KC_INITIAL_TEXT = ""; 
        const KC_SCENARIO_REQUIRED = "Primero calcule el escenario clim√°tico.";
        const KC_PLANT_REQUIRED = "Seleccione una planta para ver los resultados.";


        /**
         * Determina el nivel de la variable (A, M, B) o null si es inv√°lida.
         */
        function getLevel(value, variable) {
            if (variable === 'RS') {
                if (value === 'Soleado') return 'A';
                if (value === 'Parcialmente Nublado') return 'M';
                if (value === 'Mayormente Nublado') return 'B';
                return null; 
            }

            let numValue = parseFloat(value);
            if (isNaN(numValue) || numValue < 0) return null; // Validaci√≥n de n√∫mero positivo
            
            const roundedValue = Math.round(numValue);
            
            switch (variable) {
                case 'Tmax': 
                    if (roundedValue > 28) return 'A';
                    if (roundedValue >= 20 && roundedValue <= 28) return 'M';
                    if (roundedValue < 20) return 'B';
                    break;
                case 'Vw': 
                    if (roundedValue > 25) return 'A';
                    if (roundedValue >= 10 && roundedValue <= 25) return 'M';
                    if (roundedValue < 10) return 'B';
                    break;
                case 'HR': 
                    if (roundedValue < 55) return 'B';
                    if (roundedValue >= 55 && roundedValue <= 75) return 'M';
                    if (roundedValue > 75) return 'A';
                    break;
            }
            return null;
        }

        /**
         * Busca el valor de ET0 basado en la clave del escenario. 
         */
        function getET0(key) {
            if (ET0_MAP.hasOwnProperty(key)) {
                return { et0: ET0_MAP[key], warning: false }; 
            }
            console.error(`ERROR: Clave de escenario no encontrada: ${key}`);
            return { et0: null, warning: true };
        }

        /** Limpia los resultados de consumo y la advertencia de ET0 */
        function resetScenarioOutputs() {
            document.getElementById('et0Result').textContent = "-- mm/d√≠a";
            document.getElementById('scenarioLevels').textContent = "--";
            document.getElementById('et0Warning').classList.add('hidden');
            document.getElementById('plantModel').disabled = true;
            currentET0 = null;
            clearResults();
            // Limpia feedback de niveles
            document.getElementById('tempLevel').textContent = '';
            document.getElementById('windLevel').textContent = '';
            document.getElementById('humidityLevel').textContent = '';
            document.getElementById('kcValue').textContent = KC_INITIAL_TEXT;
        }

        /** Oculta o muestra los inputs de Radiaci√≥n Solar y Viento seg√∫n la Ubicaci√≥n */
        function toggleOutdoorInputs() {
            const location = document.getElementById('location').value;
            const outdoorInputs = document.getElementById('outdoorInputs');
            
            if (location === 'Interior') {
                outdoorInputs.classList.add('hidden');
                // Oculta el feedback de viento cuando es Interior
                document.getElementById('windLevel').textContent = '';
            } else {
                outdoorInputs.classList.remove('hidden');
            }
            // Resetea los resultados cada vez que se cambia la ubicaci√≥n
            resetScenarioOutputs();
        }

        function calculateScenario() {
            const location = document.getElementById('location').value;
            const Tmax_val = document.getElementById('tempMax').value;
            const HR_val = document.getElementById('humedadRelativa').value;
            const errorMsg = document.getElementById('errorMsg');
            
            errorMsg.classList.add('hidden');
            document.getElementById('et0Warning').classList.add('hidden'); 

            let RS_L, Vw_L, RS_display, Vw_display;
            let inputsToValidate = [
                { value: Tmax_val, name: 'Temperatura M√°xima', id: 'tempMax' },
                { value: HR_val, name: 'Humedad Relativa', id: 'humedadRelativa' }
            ];

            // 1. L√≥gica y Validaci√≥n seg√∫n Ubicaci√≥n
            if (location === 'Exterior') {
                const RS_val = document.getElementById('radiacion').value;
                const Vw_val = document.getElementById('velViento').value;

                inputsToValidate.push(
                    { value: Vw_val, name: 'Velocidad del Viento', id: 'velViento' }
                );
                
                // Validaci√≥n de Inputs
                for (const input of inputsToValidate) {
                    const num = parseFloat(input.value);
                    if (input.value.trim() === "" || isNaN(num) || num < 0) { 
                        errorMsg.textContent = `Error: Ingrese un valor num√©rico positivo para ${input.name}.`;
                        errorMsg.classList.remove('hidden');
                        document.getElementById(input.id).focus();
                        resetScenarioOutputs();
                        return;
                    }
                }

                // Clasificaci√≥n Exterior
                RS_L = getLevel(RS_val, 'RS'); 
                Vw_L = getLevel(Vw_val, 'Vw'); 
                RS_display = `${RS_L} (RS)`;
                Vw_display = `${Vw_L} (Vw)`;

            } else { // Interior (Valores fijos)
                // Validaci√≥n de Inputs (solo Tmax y HR)
                for (const input of inputsToValidate) {
                    const num = parseFloat(input.value);
                    if (input.value.trim() === "" || isNaN(num) || num < 0) { 
                        errorMsg.textContent = `Error: Ingrese un valor num√©rico positivo para ${input.name}.`;
                        errorMsg.classList.remove('hidden');
                        document.getElementById(input.id).focus();
                        resetScenarioOutputs();
                        return;
                    }
                }

                // Clasificaci√≥n Interior (Radiaci√≥n Media, Viento Bajo)
                RS_L = 'M'; 
                Vw_L = 'B'; 
                RS_display = `${RS_L} (RS - Luz Difusa)`;
                Vw_display = `${Vw_L} (Vw - Interior)`;
            }

            // Clasificaci√≥n de Tmax y HR (Com√∫n a ambas ubicaciones)
            const Tmax_L = getLevel(Tmax_val, 'Tmax');
            const HR_L = getLevel(HR_val, 'HR');

            if (Tmax_L === null || HR_L === null) {
                 errorMsg.textContent = "Error: La Temperatura o Humedad ingresada est√° fuera de los rangos extremos esperados.";
                 errorMsg.classList.remove('hidden');
                 resetScenarioOutputs();
                 return;
            }


            // 2. Determinaci√≥n de ET0
            const scenarioKey = `${RS_L},${Tmax_L},${Vw_L},${HR_L}`;
            
            document.getElementById('scenarioLevels').textContent = `${RS_display}, ${Tmax_L} (Tmax), ${Vw_display}, ${HR_L} (HR)`;
            
            const { et0: et0Value, warning } = getET0(scenarioKey);
            
            // 3. Actualizaci√≥n de la interfaz
            if (et0Value !== null) {
                currentET0 = et0Value.toFixed(1); 
                document.getElementById('et0Result').textContent = `${currentET0} mm/d√≠a`;
                document.getElementById('plantModel').disabled = false;
                document.getElementById('plantModel').selectedIndex = 0; 
                document.getElementById('et0Warning').classList.add('hidden'); 

                // Feedback de niveles (solo Tmax y HR, los otros son fijos o se ven en el input)
                document.getElementById('tempLevel').textContent = `Nivel: ${Tmax_L} | Rango: ${LEVEL_RANGES.Tmax[Tmax_L]}`;
                document.getElementById('humidityLevel').textContent = `Nivel: ${HR_L} | Rango: ${LEVEL_RANGES.HR[HR_L]}`;
                
                // Muestra Vw feedback solo si es exterior
                if (location === 'Exterior') {
                    const Vw_val = document.getElementById('velViento').value;
                    const Vw_L_outdoor = getLevel(Vw_val, 'Vw');
                    document.getElementById('windLevel').textContent = `Nivel: ${Vw_L_outdoor} | Rango: ${LEVEL_RANGES.Vw[Vw_L_outdoor]}`;
                } else {
                    document.getElementById('windLevel').textContent = '';
                }

                document.getElementById('kcValue').textContent = KC_INITIAL_TEXT; 
                clearResults();

            } else {
                document.getElementById('et0Result').textContent = "-- mm/d√≠a";
                document.getElementById('et0Warning').classList.remove('hidden');
                document.getElementById('plantModel').disabled = true;
                clearResults();
            }
        }

        function calculateConsumption() {
            if (!currentET0) {
                document.getElementById('kcValue').textContent = KC_SCENARIO_REQUIRED;
                clearResults();
                return;
            }

            const plantModel = document.getElementById('plantModel').value;
            if (!plantModel) {
                document.getElementById('kcValue').textContent = KC_PLANT_REQUIRED;
                clearResults();
                return;
            }
            
            // Mantener el texto en la secci√≥n 3 vac√≠o
            document.getElementById('kcValue').textContent = KC_INITIAL_TEXT; 

            const et0 = parseFloat(currentET0); 
            // Coeficientes de cultivo (Kc)
            const kcMap = { PM1: 0.3, PM2: 0.65, PM3: 0.9, PM4: 1.15, PM5: 1.0 };
            const kc = kcMap[plantModel];
            
            // 1. C√°lculo de Evapotranspiraci√≥n de Cultivo (ETc = ET0 * Kc)
            const ETc = et0 * kc; // mm/d√≠a
            
            // 2. Caudal Diario (mL/d√≠a) - Simplificaci√≥n: 1 mm * 10 = 10 mL (factor de √°rea de maceta)
            const caudalDiario = ETc * 10; 
            
            const consumoHora = caudalDiario / 24;
            
            // 3. D√≠as de reserva (usando la reserva por defecto de 500 mL)
            const diasReserva = currentWaterVolume / caudalDiario; 

            document.getElementById('consumoHora').textContent = `${consumoHora.toFixed(2)}`;
            document.getElementById('caudalDiario').textContent = `${caudalDiario.toFixed(1)}`;
            document.getElementById('diasReserva').textContent = `${diasReserva.toFixed(2)}`;

        }

        function clearResults() {
            document.getElementById('consumoHora').textContent = "--";
            document.getElementById('caudalDiario').textContent = "--";
            document.getElementById('diasReserva').textContent = "--";
        }

        // --- Event Listeners ---
        document.getElementById('calculateScenarioBtn').addEventListener('click', calculateScenario);
        document.getElementById('plantModel').addEventListener('change', calculateConsumption);
        document.getElementById('location').addEventListener('change', toggleOutdoorInputs); // Listener para la ubicaci√≥n
        
        // Actualizar niveles al cambiar inputs (retroalimentaci√≥n instant√°nea)
        function updateLevelFeedback(inputId, levelId, variable) {
             const val = document.getElementById(inputId).value;
             const level = getLevel(val, variable);
             const levelText = document.getElementById(levelId);
             
             if (val.trim() === "" || isNaN(parseFloat(val))) {
                 levelText.textContent = 'Ingrese valor para ver el rango';
             } else if (level) {
                 if (variable !== 'RS') {
                    levelText.textContent = `Nivel: ${level} | Rango: ${LEVEL_RANGES[variable][level]}`;
                 } else {
                    levelText.textContent = `Nivel: ${level}`;
                 }
             } else {
                 levelText.textContent = 'Valor fuera de los rangos extremos.';
             }
        }

        document.getElementById('tempMax').addEventListener('input', () => updateLevelFeedback('tempMax', 'tempLevel', 'Tmax'));
        document.getElementById('velViento').addEventListener('input', () => {
             // Solo muestra feedback de viento si la ubicaci√≥n es Exterior
            if (document.getElementById('location').value === 'Exterior') {
                updateLevelFeedback('velViento', 'windLevel', 'Vw');
            }
        });
        document.getElementById('humedadRelativa').addEventListener('input', () => updateLevelFeedback('humedadRelativa', 'humidityLevel', 'HR'));
        
        // Ejecutar al cargar para inicializar el estado "Interior"
        window.addEventListener('load', toggleOutdoorInputs);
        
    </script>
</body>
</html>
